<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Push Notifications Service Worker</title>
</head>
<body>
    <h1>Push Notification Service Worker</h1>
    <script>
    (async () => {
        const publicVapidKey = 'BBsh736IWv_0pqDl2foq6-Xc6mq3zY91H6fjkuDrbrm_hITCpfBXtdpj88LjiDAAfT-pi7z0niZ5Qk8wE2ovF3g';

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            try {
                const registration = await navigator.serviceWorker.register('https://alert.rojgarresult.app/quickpanel_push.js', {
                    scope: '/'
                });
                console.log('Service Worker registered:', registration);
            } catch (error) {
                console.error('Service Worker registration failed:', error);
            }
        }

        // Subscribe the user
        async function subscribeUser() {
            try {
                const sw = await navigator.serviceWorker.ready;
                const subscription = await sw.pushManager.subscribe({
                    userVisibleOnly: true,
                    applicationServerKey: publicVapidKey
                });

                // Prepare subscription data
                const subscriptionData = subscription.toJSON();
                console.log('User subscribed:', subscriptionData);

                // Send subscription data to the main site
                await fetch('https://www.rojgarresult.app/save-subscription', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(subscriptionData)
                });

                console.log('Subscription data sent to the server');
            } catch (error) {
                console.error('Error subscribing user:', error);
            }
        }

        // Expose the subscribe function to the parent window
        window.subscribeUser = subscribeUser;
    })();
    </script>
</body>
</html>
