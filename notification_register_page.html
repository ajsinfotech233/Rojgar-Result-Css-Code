<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Worker Registration</title>
</head>
<body>
    <h1>Service Worker Registration</h1>

    <script>
        // Wait for messages from the parent domain
        window.addEventListener('message', async (event) => {
            if (event.origin === 'https://www.rojgarresult.app' && event.data.action === 'registerServiceWorker') {
                // Extract parameters sent from the parent domain
                const { title, website_pixel_key, website_host, user_analytics_is_enabled, pixel_exposed_identifier, url } = event.data;

                // Ensure service workers are supported and available
                if (!('serviceWorker' in navigator) || !('PushManager' in window)) {
                    console.log('Service Workers or PushManager not supported.');
                    return;
                }

                try {
                    // Register the service worker
                    const registration = await navigator.serviceWorker.register('https://alert.rojgarresult.app/quickpanel_push.js', {
                        scope: '/'
                    });

                    console.log('Service Worker registered from subdomain.');

                    // Handle analytics if enabled
                    if (user_analytics_is_enabled) {
                        let data = {
                            type: 'service_worker_registered',
                            pixel_key: website_pixel_key,
                            url: window.location.href,
                            title: title
                        };

                        // Send tracking data (could be pixel tracking or event tracking)
                        navigator.sendBeacon(`${url}pixel-track/${website_pixel_key}`, JSON.stringify(data));
                    }

                    // Notify the parent domain that the service worker is registered
                    window.parent.postMessage('serviceWorkerRegistered', 'https://www.rojgarresult.app');
                } catch (error) {
                    console.error('Service Worker registration failed:', error);
                }
            }
        });
    </script>
</body>
</html>
